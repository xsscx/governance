{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/xsscx/llmcjf/schemas/session-metrics.json",
  "title": "LLMCJF Session Compliance Metrics",
  "description": "Schema for session compliance metrics used by governance compliance scoring",
  "type": "object",
  "required": [
    "session_id",
    "timestamp",
    "metrics"
  ],
  "properties": {
    "session_id": {
      "type": "string",
      "description": "Unique session identifier (e.g., 4b1411f6-d3af-4f03-b5f7-e63b88d66c44)",
      "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$"
    },
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp (e.g., 2026-02-07T00:00:00Z)",
      "format": "date-time"
    },
    "metrics": {
      "type": "object",
      "description": "Compliance metrics for scoring calculation",
      "required": [
        "user_corrections",
        "unrequested_lines",
        "format_deviations",
        "apology_count",
        "frustration_signals"
      ],
      "properties": {
        "user_corrections": {
          "type": "integer",
          "description": "Number of times user corrected agent output (penalty: -20 per occurrence)",
          "minimum": 0,
          "examples": [0, 1, 2]
        },
        "unrequested_lines": {
          "type": "integer",
          "description": "Lines of unrequested narrative/documentation (penalty: -2 per line)",
          "minimum": 0,
          "examples": [0, 50, 100]
        },
        "format_deviations": {
          "type": "integer",
          "description": "Violations of output format rules (penalty: -15 per deviation)",
          "minimum": 0,
          "examples": [0, 1, 3]
        },
        "apology_count": {
          "type": "integer",
          "description": "Unnecessary apologies in responses (penalty: -5 per apology)",
          "minimum": 0,
          "examples": [0, 2, 5]
        },
        "frustration_signals": {
          "type": "integer",
          "description": "User frustration indicators detected (penalty: -10 per signal)",
          "minimum": 0,
          "examples": [0, 1, 2]
        },
        "test_without_output": {
          "type": "integer",
          "description": "Claims of testing without showing output (penalty: -30 per occurrence)",
          "minimum": 0,
          "examples": [0, 1]
        },
        "false_success_claims": {
          "type": "integer",
          "description": "Claims contradicted by evidence (penalty: -50 per claim)",
          "minimum": 0,
          "examples": [0, 1]
        },
        "documentation_without_request": {
          "type": "integer",
          "description": "Created docs when not requested (penalty: -20 per file)",
          "minimum": 0,
          "examples": [0, 1, 3]
        },
        "scope_creep": {
          "type": "integer",
          "description": "Actions beyond requested scope (penalty: -15 per occurrence)",
          "minimum": 0,
          "examples": [0, 1]
        },
        "verification_skipped": {
          "type": "integer",
          "description": "Claims without verification (penalty: -25 per skip)",
          "minimum": 0,
          "examples": [0, 1, 2]
        }
      },
      "additionalProperties": false
    },
    "session_metadata": {
      "type": "object",
      "description": "Optional metadata about the session",
      "properties": {
        "duration_minutes": {
          "type": "number",
          "description": "Session duration in minutes",
          "minimum": 0
        },
        "turns": {
          "type": "integer",
          "description": "Number of user-agent turns",
          "minimum": 1
        },
        "violations_documented": {
          "type": "integer",
          "description": "Number of governance violations documented",
          "minimum": 0
        },
        "llmcjf_functions_used": {
          "type": "array",
          "description": "List of llmcjf_* functions invoked during session",
          "items": {
            "type": "string",
            "pattern": "^llmcjf_[a-z_]+$"
          }
        }
      }
    },
    "calculated_score": {
      "type": "integer",
      "description": "Final compliance score (0-100, calculated from metrics)",
      "minimum": 0,
      "maximum": 100
    },
    "compliance_status": {
      "type": "string",
      "description": "Overall compliance status",
      "enum": ["PASS", "FAIL", "CATASTROPHIC"]
    }
  },
  "additionalProperties": false
}
