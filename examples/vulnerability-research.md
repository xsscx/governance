# CVE Vulnerability Research Template

Structured workflow for analyzing and documenting CVE vulnerabilities with governance compliance.

## Profile Setup

```bash
source ~/.copilot/scripts/load-profile.sh security-research
```

Enforces:
- CVSS 4.0 format: `CVSS:4.0/AV:X/AC:X/...`
- Evidence-based analysis only
- No exploit speculation
- Minimal PoC code

## CVE Selection

### Discovery Methods
1. **CVE databases**: NVD, Mitre, GitHub Security Advisories
2. **Vendor advisories**: Security mailing lists, release notes
3. **Bug trackers**: Public issue reports, commit messages
4. **Fuzzing**: See `fuzzing-workflow.md`

### Prioritization Criteria
```
Priority = (CVSS_base * availability_factor * exploitability_factor)

availability_factor:
- PoC available: 1.5
- Patch available: 1.2
- No patch: 1.0

exploitability_factor:
- Remote, no auth: 1.5
- Remote, auth required: 1.2
- Local only: 0.8
```

## Research Process

### 1. Information Gathering

#### CVE Record
```bash
# Fetch CVE data
curl -s https://services.nvd.nist.gov/rest/json/cves/2.0?cveId=CVE-2024-12345 | \
  jq '.vulnerabilities[0].cve' > CVE-2024-12345.json

# Extract key fields
jq -r '.descriptions[0].value' CVE-2024-12345.json  # Description
jq -r '.metrics.cvssMetricV31[0].cvssData.vectorString' CVE-2024-12345.json  # CVSS
```

#### Vendor Advisory
```bash
# Download advisory
curl -O https://vendor.com/security/CVE-2024-12345.html

# Extract timeline
grep -i "published\|disclosed\|patched" CVE-2024-12345.html
```

#### Patch Analysis
```bash
# Find fixing commit
git log --all --grep="CVE-2024-12345"
git log --all --grep="security\|vulnerability" --since="2024-01-01"

# Show patch
git show abc123def456 > CVE-2024-12345-patch.diff

# Extract changed files
git diff-tree --no-commit-id --name-only -r abc123def456
```

### 2. Environment Setup

#### Clone Repository
```bash
mkdir -p ~/security-research/CVE-2024-12345
cd ~/security-research/CVE-2024-12345

git clone https://github.com/vendor/project
cd project
```

#### Build Vulnerable Version
```bash
# Checkout version before patch
git checkout v1.2.3  # Last vulnerable version

# Build with debug symbols
./autogen.sh
./configure CFLAGS="-g -O0 -fno-omit-frame-pointer" --enable-debug
make -j$(nproc)

# Verify version
./binary --version
```

#### Build Patched Version
```bash
# Create patched build for comparison
git checkout v1.2.4  # First patched version
./configure CFLAGS="-g -O0 -fno-omit-frame-pointer" --enable-debug
make -j$(nproc)
mv binary binary-patched
```

### 3. Vulnerability Analysis

#### Static Analysis
```bash
# Review patch diff
git diff v1.2.3..v1.2.4 -- path/to/vuln.c > vuln-diff.txt

# Identify vulnerability type
grep -i "overflow\|injection\|race\|use-after-free" vuln-diff.txt

# Extract vulnerable function
git show v1.2.3:path/to/vuln.c | sed -n '/^vulnerable_function/,/^}/p'
```

#### Dynamic Analysis
```bash
# Run with Valgrind
valgrind --leak-check=full --track-origins=yes ./binary < poc-input.bin

# Run with ASan
export ASAN_OPTIONS=symbolize=1:abort_on_error=1
./binary-asan < poc-input.bin

# Run with GDB
gdb --args ./binary poc-input.bin
(gdb) run
(gdb) bt full
(gdb) info registers
(gdb) x/32x $rsp
```

#### Code Review
```c
// Example vulnerable code (CVE-2024-12345)
void parse_header(char *input) {
    char buffer[256];
    strcpy(buffer, input);  // [FAIL] No bounds check
    process(buffer);
}

// Patched code
void parse_header(char *input) {
    char buffer[256];
    strncpy(buffer, input, sizeof(buffer) - 1);  // [OK] Bounds check
    buffer[sizeof(buffer) - 1] = '\0';
    process(buffer);
}
```

### 4. PoC Development

#### Minimal Trigger
```python
#!/usr/bin/env python3
# poc-CVE-2024-12345.py
import socket

# Trigger buffer overflow in header parser
payload = b'A' * 512  # Exceeds 256-byte buffer

s = socket.socket()
s.connect(('127.0.0.1', 8080))
s.send(payload)
s.close()
```

#### Verification
```bash
# Start vulnerable server
./binary --port 8080 &
SERVER_PID=$!

# Run PoC
python3 poc-CVE-2024-12345.py

# Check crash
dmesg | tail -20 | grep -i "segmentation fault"

# Cleanup
kill $SERVER_PID
```

### 5. CVSS Scoring

#### Calculate Score
```
CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:H/VA:H/SC:N/SI:N/SA:N

Breakdown:
- AV:N  (Network): Exploitable remotely
- AC:L  (Low complexity): No special conditions
- AT:N  (No requirements): No timing/racing
- PR:N  (No privileges): Unauthenticated
- UI:N  (No interaction): Fully automatic
- VC:H  (High confidentiality): Full memory read
- VI:H  (High integrity): Code execution possible
- VA:H  (High availability): Crash/DoS
- SC:N  (No subsequent confidentiality): Contained
- SI:N  (No subsequent integrity): Contained
- SA:N  (No subsequent availability): Contained

Base Score: 9.3 (Critical)
```

#### Justification
```markdown
**Attack Vector (AV:N)**: Vulnerability is remotely exploitable via network
socket on port 8080.

**Attack Complexity (AC:L)**: No special conditions required, single packet
triggers overflow.

**Privileges Required (PR:N)**: No authentication required, anonymous access
sufficient.

**Confidentiality (VC:H)**: Buffer overflow allows reading arbitrary stack
memory, including sensitive data.

**Integrity (VI:H)**: Return address can be overwritten, enabling code
execution.

**Availability (VA:H)**: Crash is guaranteed on exploitation.
```

### 6. Documentation

#### Research Report
```markdown
# CVE-2024-12345 Analysis Report

## Metadata
- **CVE ID**: CVE-2024-12345
- **Component**: HTTP Server v1.2.3
- **Vulnerability Type**: Stack Buffer Overflow (CWE-120)
- **CVSS**: CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:H/VA:H/SC:N/SI:N/SA:N (9.3 Critical)
- **Affected Versions**: 1.0.0 - 1.2.3
- **Fixed Version**: 1.2.4
- **Disclosure Date**: 2024-12-15
- **Patch Date**: 2024-12-20

## Summary
Stack buffer overflow in parse_header() function allows remote attackers
to execute arbitrary code via crafted HTTP header exceeding 256 bytes.

## Technical Details

### Vulnerable Code
File: `src/http.c`, Line: 123
```c
void parse_header(char *input) {
    char buffer[256];
    strcpy(buffer, input);  // No bounds check
    process(buffer);
}
```

### Root Cause
`strcpy()` does not validate input length, allowing attacker to overflow
256-byte stack buffer with arbitrarily long header.

### Trigger Conditions
1. Send HTTP request with header >256 bytes
2. Server calls `parse_header()` with attacker-controlled input
3. Stack buffer overflows, overwriting return address

### Exploitation
- **Control**: RIP/EIP via return address overwrite
- **Constraints**: NX enabled, ASLR enabled, no stack canary in v1.2.3
- **Technique**: ROP chain required for modern mitigations

## Proof of Concept
See `poc-CVE-2024-12345.py`

## Patch Analysis
Commit: `abc123def456` (2024-12-19)
```diff
- strcpy(buffer, input);
+ strncpy(buffer, input, sizeof(buffer) - 1);
+ buffer[sizeof(buffer) - 1] = '\0';
```

Fix replaces unbounded `strcpy()` with bounded `strncpy()`, preventing
overflow.

## Impact Assessment
- **Confidentiality**: HIGH - Memory disclosure possible
- **Integrity**: HIGH - Code execution achievable
- **Availability**: HIGH - DoS via crash
- **Scope**: UNCHANGED - No subsequent system compromise

## Mitigation
1. **Immediate**: Upgrade to v1.2.4 or later
2. **Workaround**: Block requests with headers >200 bytes at firewall
3. **Detection**: Monitor for unusually long HTTP headers in logs

## References
- NVD: https://nvd.nist.gov/vuln/detail/CVE-2024-12345
- Vendor Advisory: https://vendor.com/security/CVE-2024-12345
- Patch: https://github.com/vendor/project/commit/abc123def456
- CWE-120: https://cwe.mitre.org/data/definitions/120.html

## Timeline
- 2024-12-01: Vulnerability discovered (independent researcher)
- 2024-12-02: Vendor notified
- 2024-12-15: CVE assigned
- 2024-12-19: Patch committed
- 2024-12-20: Version 1.2.4 released
- 2024-12-21: Public disclosure

## Researcher Notes
- PoC tested on Ubuntu 24.04 x86_64
- Exploitation requires ROP due to NX/ASLR
- No in-the-wild exploitation detected
- Discovered via AFL++ fuzzing campaign
```

### Evidence Archive
```bash
# Create evidence package
mkdir CVE-2024-12345-evidence
cd CVE-2024-12345-evidence

cp ~/security-research/CVE-2024-12345/poc-CVE-2024-12345.py .
cp ~/security-research/CVE-2024-12345/vuln-diff.txt .
cp ~/security-research/CVE-2024-12345/crash-trace.txt .

# Generate checksums
sha256sum * > SHA256SUMS

# Archive
cd ..
tar czf CVE-2024-12345-evidence.tar.gz CVE-2024-12345-evidence/
```

## Disclosure Coordination

### Initial Contact (Day 0)
```
To: security@vendor.com
Subject: [SECURITY] Buffer Overflow in HTTP Server

Hello,

I have discovered a stack buffer overflow in parse_header() affecting
HTTP Server versions 1.0.0 through 1.2.3.

CVSS: 9.3 (Critical)
Type: CWE-120 (Stack Buffer Overflow)
Impact: Remote Code Execution

I am following coordinated disclosure with 90-day timeline. Please
confirm receipt and provide security contact for technical details.

PoC and technical analysis available upon request.

Best regards,
[Researcher Name]
```

### Technical Disclosure (Day 1)
```
[Send full analysis report and PoC after vendor confirms receipt]
```

### Status Updates (Day 30, 60)
```
To: security@vendor.com
Subject: Re: [SECURITY] Buffer Overflow in HTTP Server - 30 Day Status

Hello,

This is a status check on CVE-2024-12345. Please provide update on:
1. Patch development timeline
2. Expected release date
3. CVE assignment status

Public disclosure planned for Day 90 (YYYY-MM-DD) unless extended.

Best regards,
[Researcher Name]
```

### Public Disclosure (Day 90)
```markdown
# Blog Post: CVE-2024-12345 - Remote Code Execution in HTTP Server

[Full technical analysis, PoC, and remediation guidance]

Published with vendor coordination after 90-day responsible disclosure period.
```

## Automation Scripts

### Batch CVE Analysis
```bash
#!/bin/bash
# analyze-cve.sh CVE-2024-12345

CVE_ID="$1"
WORK_DIR="$HOME/security-research/$CVE_ID"

mkdir -p "$WORK_DIR"
cd "$WORK_DIR"

# Fetch CVE data
curl -s "https://services.nvd.nist.gov/rest/json/cves/2.0?cveId=$CVE_ID" | \
  jq '.vulnerabilities[0].cve' > "${CVE_ID}.json"

# Extract CVSS
jq -r '.metrics.cvssMetricV31[0].cvssData.vectorString' "${CVE_ID}.json"

# Extract description
jq -r '.descriptions[0].value' "${CVE_ID}.json" > description.txt

echo "CVE data saved to $WORK_DIR"
```

## References

- NVD API: https://nvd.nist.gov/developers/vulnerabilities
- CVSS 4.0 Spec: https://www.first.org/cvss/v4.0/specification-document
- CWE List: https://cwe.mitre.org/data/index.html
- Disclosure Guide: https://vuls.cert.org/confluence/display/CVD
- Governance: `~/.copilot/governance/COPILOT_GOVERNANCE.md`
- Profile: `~/.copilot/profiles/security-research.json`
